# [ 혼공네트 ] 03-1 LAN을 넘어서는 네트워크 계층

## 데이터 링크 계층의 한계

개념

- 물리 계층과 데이터 링크 계층만으로는 LAN을 넘어서 통신하기 어렵다.
- 패킷이 이동할 최적의 경로를 결정하는 것은 라우팅
- 라우팅을 수행하는 대표적인 장비가 라우터

1. 물리 계층과 데이터 링크 계층만으로는 다른 네트워크까의 도달 경로를 파악하기 어렵습니다.
   LAN에 속한 호스트끼리만 통신하지 않고 다양한 경로를 통해 이동한다.
   물리 계층과 데이터 링크 계층의 장비로는 라우팅을 수행할 수 없지만 네트워크 계층의 장비로는 가능함

2. MAC주소만으로는 모든 네트워크에 속한 호스트의 위치를 특정하기 어렵습니다.
   택배의 수신인 역할을 하는 정보가 MAC주소, 수신지 역할을 하는 정보는 네트워크 계층의 IP주소
   네트워크에서도 MAC주소와 IP주소를 함께 사용, IP주소 == 논리주소 를 우선으로 활용함
   MAC주소는 일반적으로 NIC마다 할당되는 고정된 주소, IP주소는 호스트에 직접 할당이 가능함
   DHCP라는 특정 프로토콜을 통해 자동으로 할당받거나 사용자가 직접 할당할 수 있고, 한 호스트가 복수의 IP주소를 가질수도 있음

## 인터넷 프로토콜

IP는 두가지 버전 존재함

1. IP버전4 (이하 IPv4)
2. IP버전 6(이하 IPv6)

일반적으로 IP혹은 IP주소를 이야기할 때는 주로 IPv4를 의미하는 경우가 많음

# IP주소 형태

IP주소는 4바이트(32바이트)로 주소를 표현
숫자당 8비트로 표현되기에 0~255 범위 안에 있는 네 개의 10진수로 표기
각 10진수는 점(.)으로 구분, 점으로 구분된 8비트 (0~255범위의 10진수)를 옥텟 이라고 함

# IP의 기능

IP 주소 지정 : IP주소를 바탕으로 송수신 대상을 지정하는 것을 의미
IP 단편화: 전송하고자 하는 패킷의 크기가 MTU라는 최대 전송 단위보다 클 경우, 이를 MTU크기 이하의 복수의 패닛으로 나누는 것을 의미
MTU: 한 번에 전송 가능한 IP패킷의 최대 크기를 의미, IP패킷의 헤더라도 MTU크기에 포함된다는 점을 유의
일반적인 MTU크기는 1500바이트, MTU크기 이하로 나누어진 패킷은 수신지에 도착하면 다시 재조함됨

# IPv4

1. 식별자 2. 플래그 3. 단편화 오프셋 4. TTL 5. 프로토콜 6. 송신지 IP주소 7. 수신지 IP주소의 총 7
   단편화 기능에 관여 - 식별자, 플래그, 단편화 오프셋 필드
   주소 지정 기능 관여 - 수신지 IP주소, 수신지 IP주소

1. 식별자 : 패킷에 할당된 번호
1. 플래그 : 총 세 개의 비트로 구성된 필드, 첫 번째 비트는 항상 0으로 예약된 비트로 현재 사용하지 않음
   DF : 나머지 2개의 비트 중에서 하나는 DF라는 이름이 붙은 비트로 IP단편화를 수행하지 말라는 표
   MF: 단편화된 패킷이 더 있는지나타냄
1. 단편화 오프셋 : 수신지가 패킷들을 순서대로 재조합하려면 단편화된 패킷이 초키 데이터에서 몇 번째 데이터에 해당하는 패킷인지 알아야 하고 이를 판단하기 위해 단편화 오프셋이 활용됨
1. TTL (Time To Live)
   멀리 떨어진 호스트끼리 통신할 때 패킷은 여러 라우터를 거쳐 이동할 수 있고 패킷이 하나의 라우터를 거칠 때마다 TTL이 1씩 감소하며, TTL값이 0으로 떨어진 패킷은 폐기됨
   홉: 패킷이 호스트 또는 라우터에 한번에 전달되는 것
1. 프로토콜 : IP패킷의 프로토콜은 상위 계층의 프로토콜이 무엇인지를 나타내는 필드
1. 송신지 IP주소
1. 수신지 IP주소

IPv4는 식별자, 플래그, 단편화 오프셋트로 단편화와 재조합을 할 수 있고, 프로토콜 필드로 상위 계층 프로토콜을 알 수 있으며, TTL로 패킷의 남은 수명을 파악할 수 있음 또한 송신지 IP주소, 수신지 IP주소를 통해 IP주소를 지정할 수 있음

# IPv6

IPv4주소는 총량은 쉽게 고갈될 수 있어 등장한 것임

16바이트 (128비트)로 주소를 표현할 수 있고, 콜론(:)으로 구분된 8개 그룹의 16진수로 표기됨 다시 말해 할당 가능한 IPv6주소는 이론적으로 사실상 무한에 가까운 개수를 할당할 수 있음

1. 다음 헤더 : 필드는 상위 계층의 프로토콜을 가리키거나 확장 헤더를 가리킴 IPv6는 추가적인 헤더 정보가 필요할 경우에 기본 헤더와 더불어 확장 헤더라는 추가 헤더를 가질 수 있습니다.
2. 홉 제한: 패킷의 수명을 나타내는 필드
3. 송신지 IP주소
4. 수신지 IP주소
   IPv4헤더 길이는 가변적이나 IPv6 기본 헤더는 40바이트로 고정적임
   현재 유망한 프로토콜로 떠오르고 있는 만큼 다수의 장비에서 지원함

# ARP

상대 호스트의 IP주소는 알지만, MAC주소는 알지 못하는 상황에 ARP라는 프로토콜을 사용함
ARP는 IP주소를 통해 MAC주소를 알아내는 프로토콜
동일 네트워크내에 있는 송수신 대상의 IP주소를 통해 MAC주소를 알아낼 수 있음

1. ARP요청
   ARP패킷으로 '저 10.0.0.2와 통신하고 싶은데, MAC즈소가 무엇인가요?'
2. ARP응답
   네트워크 내의 모든 호스트가 ARP요청 메시지를 수신하지만, B를 제외한 나머지 호스트는 자신의 IP주소가 아니므로 이를 무시함
   B는 자신의 MAC주소를 담은 메시지를 A에게 전송함 이 유니캐스트 메시지는 ARP응답이라는 ARP패킷임
   B의 MAC주소가 포함된 메시지를 수신한 A는 B의 MAC주소를 알게됨
3. ARP테이블 갱신
   ARP를 활용할 수 있는 모든 호스트는 ARP테이블이라는 정보를 유지하고 ARP테이블은 IP주소와 그에 맞는 MAC주소 테이블을 대응함
   ARP는 동일 네트워크에 속한 호스트의 MAC즈소를 알아내기 위해 사용하는 프로토콜
   다른 네트워크에 속한 호스트에게 패킷을 보내야 할 경우 네트워크 외부로 나가기 위한 장비(라우터)의 MAC주소를 알아내어 패킷을 전송함
