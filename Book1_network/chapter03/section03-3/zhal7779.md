# chapter 03-3 라우팅

라우터의 핵심 기능은 패킷이 이동할 최적의 경로를 설정한 뒤 해당 경로로 패킷을 이동시키는 것이다. 이를 라우팅이라 하는데, 라우팅을을 가능하게 하는 정보인 라우팅 테이블을 알아보고, 라우팅 프로토콜에 대해 알아보자.
<br />
<br />

## 라우터

- 라우터는 네트워크 계층의 핵심 기능을 담당한다.
- 멀리 떨어져 있는 호스트 간의 통신 과정에서 패킷은 서로에게 도달하기까지 여러 라우터를 거쳐서 다양한 경로로 이동할 수 있다.
- 라우팅 도중 패킷이 호스트와 라우터 간에, 혹은 라우터와 라우터 간에 이동하는 하나의 과정을 홉이라고 부르며, 패킷은 여러 홉을 거쳐 다른 네트워크 내의 호스트로 이동할 수 있다.
- 일반적으로 가정에서는 공유기가 라우터 역할을 하는데, 그래서 공유기를 홈 라우터라고 부르기도 한다.
<br />

<img src="https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FwSaY8%2FbtsvjgNcmC7%2Fm4lF0dQcaDRmkk4cZKMeR1%2Fimg.png" />
<br />

## 라우팅 테이블

- 라우팅의 핵심은 라우터가 저장하고 관리하는 라우팅 테이블이다. 라우터 테이블은 특정 수신지까지 도달하기 위한 정보를 명시한 일종의 표와 같은 정보이다.
- 라우터는 라우팅 테이블을 참고하여 수신지까지의 도달경로를 판단한다.
- 라우팅 테이블에 포함된 정보는 라우팅 방식이나 호스트의 환경에 따라 달라질 수 있으나, 공통적인 정보이자 핵심적인 정보로 수신지 IP 주소,  서브넷 마스크, 다음 홉, 네트워크 인터페이스, 메트릭이 있다.
- **수신지 IP주소** 와 **서브넷 마스크 :**  최종적으로 패킷을 전달할 대상을 의미한다.
- **다음 홉(게이트웨이) :** 최종 수신지까지 가기 위해 다음으로 거쳐야 할 호스트의 IP주소나 인터페이스를 의미한다.
- **네트워크 인터페이스 :** 패킷을 내보낼 통로 이다.
- **메트릭 :** 경로로 이동하는 데에 드는 비용을 의미한다. 라우터가 라우팅 테이블에 있는 경로 중 패킷을 내보낼 경로를 선택할 때 메트릭이 낮은 경로를 선호한다.

라우팅 테이블에 없는 경로로 패킷을 전송해야 할 때가 있다, 이 경우에는 기본적으로 패킷을 내보낼 경로를 설정하여 해당 경로로 패킷을 내보낼 수 있다. 이 기본경로를 **디폴트 라우트** 라고 한다. 

디폴트 라우트는 모든 IP 주소를 의미하는 0.0.0.0/0으로 명시한다.
<br />

## 정적 라우팅과 동적 라우팅

**정적라우팅**

- 사용자가 수동으로 직접 채워 넣은 라우팅 테이블의 항목을 토대로 라우팅 되는 방식이다.
- 라우팅 테이블 항목을 다루는 명령어를 사용하여 수동으로 구성된 라우팅 테이블 항목을 통해 수행되는 라우팅을 정적 라우팅이라고 표현한다.

**동적라우팅**

- 네트워크의 규모가 커지고 관리해야 할 라우터가 늘어나면 정적 라우팅만으로는 관리자가 버겁다. 수동으로 라우팅 테이블 항목을 입력해야 하는 정적 라우팅의 특성상 입력을 실수 할 수도 있고 실수 없이 입력했더라도 라우팅되는 경로상에 예상치 못한 문제가 생길 수 있도 있다.
- 이때 사용하는 방식이 동적라우팅이며, 동적라우팅은 라우팅 프로토콜을 통해 자동으로 라우팅 테이블 항목을 만들고, 이를 이용하여 라우팅하는 방식이다.
- 동적 라우팅을 하면 라우팅 테이블 항목이 수시로 변할 수 있어, 대규모 네트워크를 관리할 때 사용한다.
- 동적라우팅은 네트워크 경로상에 문제가 발생했을 때 이를 우회할 수 있게 경로가 자동으로 갱신된다.
<br />

## 라우팅 프로토콜

라우터들끼리 자신들의 정보를 교환하며 패킷이 이동할 최적의 경로를 찾기 위한 프로토콜이다.

라우팅 프로토콜은 라우팅의 범위에 따라 AS 내부에서 수행되는 IGP, AS 외부에서 수행되는 EGP로 나뉜다.
<br />
**IGP: RIP와 OSFP**

- 대표적인 IGP로는 RIP와 OSFP가 있다.
- IGP 라우팅 방식은 최적의 경로를 선정하는 과정에서 거리 벡터가 사용되느냐, 링크 상태가 사용되느냐로 구분할 수 있으며, RIP는 거리벡터를, OSFP는 링크 상태를 사용하는 라우팅 프로토콜이다.
- RIP는 거리 벡터 라우팅 프로토콜이란 이름 그대로 거리를 기반으로 최적의 경로를 찾는 라우팅 프로토콜을 의미한다. 거리는 패킷이 경유한 라우터의 수 , 즉 홉의 수를 의미한다.
- OSFP는 링크 상태 라우팅 프로토콜로, 링크 정보를 비롯한 현재 네트워크의 상태를 그래프 형태로 링크 상태 데이터베이스에 저장한다. 
링크 상태 데이터베이스에는 라우터들의 연결 관계, 연결 비용 등 현재 네트워크의 상태를 그래프로 표현하기 위한 데이터가 저장되어 있다. 라우터는 링크 상태 데이터베이스르ㅜㄹ 기반으로 현재 네트워크 구성을 지도처럼 그린 뒤 최적의 경로를 선택한다.
<br />

**EGP: BGP**

- 대표적인 EGP로는 BGP가 있다.
- BGP는 AS 간의 통신에서 사용되는 대표적인 프로토콜로,  AS 간의 통신이 가능한 프로토콜이다.
- BGP는 OSFP에 비해 경로 결정 과정에서 수신지 주소와 다양한 ‘속성’, ‘정책’이 고려되기 때문에 최적의 경로를 결정하는 과정이 복잡하고, 일정하지 않은 경우가 많다.
- BGP의 대표적인 속성은 AS-PATH, NEXT-HOP, LOCAL -PREF가 있다.
