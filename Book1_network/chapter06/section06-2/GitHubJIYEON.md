# 와이어샤크를 통한 프로토콜 분석

## IP분석 (생락)

### IPv4단편화 + ICMP

### IPv6단편화 + UDP

## TCP 분석

**TCP 연결 수립**

3-way-handshake 파일 열어 TCP의 연결 수립 과정을 살펴보기
TCP는 연결형 통신을 수행하는 프로토콜이고, 연결 수립 과정은 쓰리 웨이 핸드셰이크를 통해 이루어짐

첫 번째 패킷의 [Transmission Control Protocol] 항목

-   송신지 포트 번호와 수신지 포트 번호
-   순서 번호 ( 와이어샤크에서 보기 편하도록 상대적인 순서 번호를 매김)
-   쓰리 웨이 핸드셰이크를 시작하는 세그먼트의 SYN비트는 1로 설정된 것을 확인 할 수 있음
-   하단에 확인 응답 번호가 있음
-   쓰리 웨이 핸드셰이크 과정의 두 번째 세그먼트는 SYN비트와 ACK 비트가 1로 설정된 세그먼트
-   쓰리 웨이 핸드셰이크의 마지막 단계는 두번째 패킷에 대한 ACK 세그먼트를 전송하는 것

**TCP 연결 종료**

-   TCP의 연결 종료 과정은 통신을 주고받는 호스트가 서로FIN과 ACK를 주고받으며 이루어짐
-   첫 번째 패킷에서 FIN 비트가 설정된 세그먼트를 전송 = 연결 종료 요청(액티브 클로즈의 과정)
-   두 번째 패킷에서 첫 번째 패킷에 대한 응답을 ACK 비트가 설정된 세그먼트를 전송
-   어느 정도의 시간이 흐른 뒤 FIN비트가 설정된 세 번째 세그먼트를 보냄
-   마지막으로 ACK비트가 설정된 세그먼트를 보내면 연결 종료 과정이 완료!
-   네 번째 패킷을 받으면 즉시 연결이 종료되고, 네 번째 패킷을 전송한 후에 일정 시간을 대기한 뒤 연결이 종료 될 것입니다.

**TCP 재전송**

TCP는 신뢰성을 제공하고자 재전송 기반의 오류 제어를 수행합니다.

-   1번 패킷에 응답으로 순서 번호 패킷을 보내고, 확인 응답 번호를 보냄
    여기서, 2번 패킷이 유실되어 정상적으로 송신되지 않았다고 가정해보면
-   3번 패킷에서 2번 유실되었으므로 2번 패킷의 순서 번호를 받지 못해 3번 패킷의 확인 응답 번호는 1번과 동일합니다.
-   ACK세그먼트를 다시 보내고 중복된 ACK세그먼트를 보내야 하는 상황, 중복된 ACK세그먼트를 보낸 것입니다.
-   5번 패킷 이 패킷은 4번 패킷에서 보내달라고 했던 순서 번호가 아니기에 한번 더 중복된 ACK세그먼트를 보냅니다.
-   7번 패킷 기대한 패킷이 아님
-   8번 패킷 이는 세번째로 중복된 ACK 세그먼트
-   세 번의 중복된 ACK 세그먼트를 수신하면 빠른 재전송과 더불어 빠른 회복 알고리즘이 수행됨
-   빠른 재전송을 수행하는 패킷이 9번 패킷, 드디어 원했던 패킷을 전송받았습니다.

\*tcp.analysis.retransmisson필터를 사용하면 재전송된 패킷을 필터링할 수 있고, tcp.analysis.fast_retransmission 필터를 사용하면 다음 화면처럼 빠른 재전송에 해당하는 패킷을 필터링 할 수 있음

## HTTP 분석

**HTTP 분석하기**

http-request-response 파일 열어 보면
(HTTP의 요청과 응답 헤더의 분석은 5장에서 언급한 대로 웹 브라우저의 개발자 도구를 이용해도 쉽게 할 수 있습니다.)

1번 패킷 속 HTTP 메시지 보기
(http://info.cern.c/같은 주소를 입력했을 때 캡쳐된 패킷)

요청을 보낸 호스트는 info.cern.ch이며, 요청을 보낸 경로는 /이고, 요청에 사용된 HTTP는 GET인 것을 확인할 수 있음
