# chapter 07-2 안전성을 위한 기술

민감한 정보를 평문으로 주고 받을 때 제 3자가 메시지를 훔쳐보거나 메시지를 가로채 변조할 수 있기 때문에, 암호화가 필요하다.

암호화는 원문 데이터를 알아볼 수 없는 형태로 변경하는 것을 의미하며, 반대로 복호화란 암호화된 데이터를 원문 데이터로 되돌리는 과정을 말한다. 암호화와 복호화는 안전한 데이터 송수신 뿐만 아니라 인증서 기반의 검증도 가능하다.
<br />
<br />

## 암호와 인증서

암호화와 복호화의 핵심은 키이다. 
<br />

**대칭 키 암호화 방식과 공개 키 암호화 방식**

컴퓨터 보안에서 사용되는 키는 무작위해 보이는 문자열처럼 생겼다. 키와 원문 데이터에 수학적 연산 과정을 거치면 암호문이 생성된다. 이 수학적 연산 과정을 ‘암호화 알고리즘’이라 부른다. 

그리고 암호문을 수신자 측에서 복호화하면 원문 메시지를 얻을 수 있다. 당연하게도 복호화하지 않은 암호문은 제 3자가 몰래 본다 해도 그 의미를 알 수 없다.
<br />


주고받는 데이터를 암호화하고 복호화하는 방법에는 대칭 키 암호화와 비대칭키 암호화라는 두가지방식이 있다.
<br />

- **대칭 키 암호화**
    - 대칭 키 암호화 방식에는 암호화와 복호화에 동일한 키를 사용한다.
    - 대칭 키 암호화 방식에는 상대방에게 안전하게 키를 전달하기 어렵다는 문제가 있다.
    - 대칭 키 암호화 방식은 암호화와 복호화에 동일한 키를 사용하므로 키가 유출되면 큰 문제가 발생한다.
<br />

- **공개 키 암호화**
    - 비대칭 키 암호화라고도 불리며, 암호화와 복호화에 단일한 키를 사용했던 대칭 키 암호화와 달리, 공개 키 암호 방식에서는 암호화를 위한 키와 복호화를 위한 키가 다르다.
    - 한 키로 암호화 했다면 다른 키로 복호화 할 수 있다.
    - 이 한쌍의 키를 각각 공개 키 와 개인 키라고 부른다. 공개 키만으로는 개인 키를 유추할 수 없고, 반대로 개인 키 만으로 공개 키를 유추할 수 없다.
    
<br />
<br />

대칭 키 암호화 방식과 공개 키 암호화 방식은 각각 장단점이 있다. 

**⇒ 대칭 키 암호화는 키를 안전하게 전송하기 어렵지만, 적은 부하 덕분에 암호화 및 복호화를 빠르게 수행 할 수 있다.**

**⇒ 공개 키 암호화는 암호화 및 복호화에 시간과 부하가 상대적으로 많이 들지만, 키를 안전하게 공유할 수 있다.**
<br />

⇒ 각, 장단점을 이용해 대칭 키 암호화와 공개 키 암호화를 함께 사용하는 경우가 많다.
예를 들어 대칭 키를 상대에게 안전하게 전달하기 위해 공개 키로 암호화하고, 개인 키로 암호화된 대칭 키를 복호화 한다. 

이렇게 하면 대칭 키를 안전하게 공유함과 동시에 공유한 대칭 키를 이용해 빠르게 암호화/복호화를 수행할 수 있다. 이러한 방식으로 활용되는 대칭 키를 **세션 키**라고 한다.
<br />
<br />

**인증서와 디지털 서명**

공개 키 인증서란 네트워크(인터넷)에서 사용되는 ‘인증서’라는 용어를 일반적으로 ‘공개 키 인증서’라고 일컬으며,  공개 키와 공개 키의 유효성을 입증하기 위한 전자 문서 이다.

웹 서버는 전달받은 공개 키가 정말 신뢰할 수 있는 것인지 판단하기 위해, 공개 키뿐만 아니라 누가 생성했는지, 조작되지는 않았는지, 유효 기간은 언제까지인지 등의 내용을 포함한 인증서를 전송한다. 
<br />

이러한 인증서는 인증 기관이라는 제 3의 기관에서 발급한다. 
인증 기관은 발급, 검증, 저장과 같은 역할을 수행할 수 있는 공인 기관이다. 일반적으로 CA라고 줄여서 부른다. 
<br />

CA에서 발급한 인증서에는 ‘이 공개 키 인증서는 진짜야. 내가 보증할게’라는 내용을 담은 서명값이 있다. 클라이언트는 이 서명 값을 바탕으로 인증서를 검증할 수 있다.

개인 키로 암호화된 메시지를 공개 키로 복호화함으로써 신원을 증명하는 절차를 디지털 서명이라고 한다.
<br />
<br />

## HTTPS: SSL과 TLS

SSL과 TLS는 인증과 암호화를 수행하는 프로토콜이며, TLS는 SSL을 계승한 프로토콜이다. 따라서 SSL과 TLS의 작동 과정은 사용되는 암호 알고리즘과 버전에 따라 세부적인 차이가 있을 수 있으나 큰 틀에서 보면 유사하다.
<br />

**SSL/TLS를 사용하는 대표적인 프로토콜은 HTTPS이다. HTTPS는 HTTP 메시지의 안전한 송수신을 위해 개발된 프로토콜이다.**

오늘날 주로 사용되는 TLS 1.3을 기반으로 HTTPS가 어떻게 동작하는지 간략하게 알아보자.

HTTPS 메시지는 크게 다음과 같은 단계를 거쳐 송수신된다.
<br />

1. **TCP 쓰리 웨이 핸드셰이크**
    - TCP 연결을 수립하기 위해 두 호스트가 각각 SYN, SYN+ACK, ACK 플래그가 설정된 TCP 세그먼트를 주고받는 것이 쓰리 웨이 핸드 셰이크다.
2. **TLS 핸드셰이크**
    - 암호화에 사용할 키와 인증서를 주고 받을 수 있다.
3. **암호화된 메시지 송수신**
