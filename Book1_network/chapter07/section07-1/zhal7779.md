# chapter 07-1 안전성을 위한 기술
<br/>
<br/>

## 가용성

‘네트워크가 안정적이다.’ ‘서버가 불안정하다’와 같은 표현은 흔히 사용되는 표현이다. 

여기서 **안정성이란 ‘특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성’이라고 정의할 수 있다.** 예를 들어 안정적인 웹 서버는 언제든지 응답 메시지를 제공할 수 있는 서버를 의미하며, 안정적인 라우터는 언제든지 라우팅 기능을 제공할 수 있는 라우터를 의미한다. 

안전성을 수치화하여 안정성의 정도를 나타낼 수 있는 용어로는 가용성과 고가용성이 있다. 

**가용성이란 ‘컴퓨터 시스템이 특정 기능을 실제로 수행할 수 있는 시간의 비율’을 의미한다.** 여기서 컴퓨터 시스템은 서버나 네트워크 혹은 프로그램이 될 수 있다.  다시말해 가용성은 전체 사용 시간 중에서 정상적인 사용시간을 의미한다. 

**고가용성이란 가용성이 높은 성질을 의미한다. 안정적인 시스템은 가용성이 높다.** 고가용성을 유지하는 것은 모든 웹 서비스 업체들의 대단히 중요한 목표이다.

그렇다면 안정적인 수준은 백분율로 표기했을 때 몇 퍼센트 정도일까? 일반적으로 ‘안정적’이라고 평가받는 시스템은 99.999%이상을 목표로 한다. 
<br/>
<br/>

## 이중화

**이중화란 말 그대로 ‘무언가를 이중으로 두는 기술’이다.**

**이는 결함을 감내하여 가용성을 높이기 위한 가장 기본적이고 대표적인 방법으로, 쉽게 말해 ‘예비(백업)을 마련하는 방법’이다.**

이중화할 수 있는 대상은 다양하며, 서버 컴퓨터, 네트워크 인터페이스(NIC), 스위치와 같은 물리적 장비뿐만 아니라, 데이터베이스, 웹 서버 프로그램 등도 이중화할 수 있는 대상이다. 그리고 이중화할 수 있는 대상들은 대부분 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상이라는 공통점이 있다. 

이중화 구성에는 크게 두 가지 방식이 있다.

액티브는 가동 상태를 의미하며, 스탠바이는 액티브의 백업으로서 대기하는 상태를 의미한다.

- **액티브/스탠바이**
    - 액티브/스탠바이는 한 시스템은 가동하고, 다른 시스템은 백업 용도로 대기 상태(스탠바이)로 두는 이중화 구성 방식
    - 액티브인 시스템에 문제가 발생할 경우 스탠바이 시스템이 자동으로 액티브 시스템을 대신하여 동작한다.
    - 안전한 구성 방식이지만, 두 장비가 동시에 가동되지 않고 한 번에 하나만 가동되기 때문에 성능상의 큰 변화를 기대하기는 어렵다.
- **액티브/액티브**
    - 액티브/액티브는 두 시스템 모두를 가동 상태로 두는 구성 방식
    - 두 시스템이 함께 가동되므로 부하를 분산시킬 수 있고, 성능상의 이점도 있다. 다만 한 시스템에 문제가 발생하면 순간적으로 다른 시스템에 부하가 급증할 수 있으며, 이로 인해 추가적인 문제가 발생할 수 있다.

‘무언가를 여러 개 두는 기술’도 있는데 이를 다중화라고 한다. 다중화하면 이중화된 구성에 비해 더욱 안정적인 운영이 가능하다. 

오늘날 많은 사용자가 이용하는 거의 모든 서비스는 하나 이상의 시스템이 다중화되어 구성된다.
<br/>
<br/>

## 로드 밸런싱

고가용성을 요구하는 호스트는 클라이언트보다는 일반적으로 서버이다.

서버를 다중화했더라도 트랙픽 분배가 남아있다. 트랙픽은 서버의 가용성에 가장 큰 영향을 끼치는 요소이다. 

**트래픽의 사전적 정의는 ‘주어진 시점에 네트워크를 경유한 데이터의 양’이지만, 일반적으로 트래픽 측정은 노드에서 이루어지므로 일반적으로 표현하면 ‘ 주어진 시점에 특정 노드를 경유한 패킷의 양’을 트래픽이라고 볼 수 있다.** 

서버에 과도한 트래픽이 몰리면, 높은 부하로 인해 CPU는 발열이 심해지고, 메모리 공간은 수많은 트래픽 내용을 저장하기에 부족해질 수 있다.

**특정 서버에만 트랙픽이 몰릴 경우 가용성이 떨어질 수 있다. 따라서 서버를 다중화했더라도 트래픽을 고르게 분산해야 가용성이 높아진다.** 

**트래픽의 고른 분배를 위해 사용되는 기술이 로드 밸런싱이다. 로드 밸런싱은 부하를 의미하는 단어닌 로드와 균형 유지를 나타내는 단어인 밸런싱이 합쳐진 단어이다. 로드 밸런싱은 로드 밸러서에 의해 수행된다.** 

대표적인 웹 서버 소프트웨어인 Nginx에도 로드 밸런싱 기능이 내포되어 있다.

**로드 밸런서는 일반적으로 이중화나 다중화된 서버와 클라이언트 사이에 위치한다. 클라이언트들은 로드 밸런서에 요청을 보내고, 로드 밸런서는 해당 요청을 각 서버에 균등하게 분배한다.**

로드 밸런서가 부하를 균등하게 분산되도록 부하 대상을 선택하는 방법을 ‘로드 밸런싱 알고리즘’이라 부른다.

로드 밸런싱 알고리즘의 종류는 다양하지만 대표적인 알고리즘으로는 단순히 서버를 돌아가며 부하를 전달하는 **라운드 로빈 알고리즘**과 연결이 작은 서버부터 우선적으로 부하를 전달하는 **최소 연결 알고리즘**이 있다. 때로는 단순히 무작위로 고르기도 하고, 해시라는 자료구조를 이용하기도 하며, 응답 시간이 가장 짧은 서버를 선택하기도 한다.
