# chapter 05-2 HTTP

HTTP에는 중요한 네 가지 특성이 있다. HTTP는 첫째, 요청과 응답 기반으로 동작하고, 둘째, 미디어 독립적이며, 셋째, 상태를 유지하지 않고, 넷째, 지속 연결을 지원한다. 

HTTP의 네 가지 특성을 기반으로 HTTP를 학습해 보자.
<br />
<br />

## HTTP의 특성

HTTP는 응용 계층에서 정보를 주고 받는데 사용되는 프로토콜이다. HTTP의 주요 특성은 다음과 같다.
<br />

**요청-응답 기반 프로토콜**

HTTP는 ‘클라이언트-서버 구조 기반의 요청 - 응답 프로토콜’이다. **HTTP는 클라이언트와 서버가 서로 HTTP 요청 메시지와 HTTP 응답 메시지를 주고 받는 구조로 동작한다.**

그렇기에 같은 HTTP 메시지일지라도 HTTP 요청 메시지와 HTTP 응답 메시지는 메시지 형태가 다르다. 
<br />

**미디어 독립적 프로토콜**

**HTTP는 주고받을 자원의 특성과 무관하게 그저 자원을 주고 받을 수단(인터페이스)의 역할만 수행한다. 실제로 HTTP를 통해서 HTML, JPEG, PNG, JSON, XML, PDF 파일 등 다양한 종류의 자원을 주고받을 수 있다.** 

HTTP에서 메시지로 주고 받는 자원의 종류를 미디어 타입이라 부른다. MIME 타입이라고도 부른다. 

HTTP는 주고받을 미디어 타입에 특별히 제한을 두지 않고 독립적으로 동작이 가능한 미디어 독립적인 프로토콜이라 할 수 있다. 

여기서 미디어 타입이란 일종의 웹 세상의 확장자 같은 개념이다. 일반적으로 파일의 종류를 .html, .png, .json, .mp4 같은 확장자로 나타낼 수 있듯이, HTTP를 통해 송수신하는 정보의 종류는 미디어 타입으로 나타낼 수 있다.
<br />

**미디어 타입은 기본적으로 슬래시를 기준으로 하는 ‘타입/서브타입’ 형식으로 구성된다. 타입은 데이터의 유형을 나타내고, 서브 타입은 주어진 타입에 대한 세부 유형을 나타낸다.**

(ex. text/plain ⇒ 평문 텍스트 문서, text/html ⇒ html 문서, application/json ⇒JSON 형식 데이터)
<br />

**스테이트리스 프로토콜**

**HTTP는 상태를 유지하지 않는 스테이트리스 프로토콜이다. 이는 서버가 HTTP 요청을 보낸 클라이언트와 관련된 상태를 기억하지 않는다는 의미이다.**

그렇기에 클라이언트의 모든 HTTP 요청은 기본적으로 독립적인 요청으로 간주된다. 

HTTP는 서버는 일반적으로 많은 클라이언트와 동시에 상호 작용 한다. 동시에 처리해야 할 요청 메시지의 수는 수천, 수만개가 될 수도 있다. 이러한 상황에서 모든 클라이언트의 상태 정보를 유지하는 것은 서버에게 큰 부담이다. 

또한, 서버는 하나가 아니라 여러대로 구성될 수도 있기에,  모든 서버가 모든 클라이언트의 상태를 유지할 경우 모든 클라이언트의 상태 정보를 공유하는 작업은 매우 번거롭고 복잡하기에 클라이언트는 여러 서버를 동시에 이용하기가 어려워진다.

**HTTP가 처음 만들어졌을 때부터 오늘날까지 이어지는 중요한 설계 목표는 바로 확장성와 견고성이다.**

**상태를 유지하지 않는 스테이트리스한 특성은 필요하다면 언제든 쉽게 서버를 추가할 수 있기 때문에 확장성이 높고, 서버 중 하나에 문제가 생겨도 다른 서버로 대체가 가능하기에 견고성이 높다.**
<br />

**지속 연결 프로토콜**

HTTP는 지속해서 발전중인 프로토콜인 만큼 여러 버전이 있다.

기본적으로 HTTP는 TCP 상에서 동작하는데, HTTP는 비연결형 프로토콜이지만, TCP는 연결형 프로토콜이다. 따라서 초기의 HTTP 버전은 쓰리 웨이 핸드셰이크를 통해 TCP 연결을 수립한 후, 요청에 대한 응답을 받으면 연결을 종료하는 방식으로 동작했다. 추가적인 요청-응답을 하기 위해서는 다시 TCP 연결을 수립해야 해서, 이러한 방식을 비지속 연결이라 한다.

하지만 최근 대중적으로 사용되는 HTTP 버전은 지속 연결이라는 기술은 제공한다. 이는 하나의 TCP 연결상에서 여러 개의 요청-응답을 주고 받을 수 있는 기술이다.

**지속 연결 기능을 지원하는 HTTP는 매번 새롭게 연결을 수립하고 종료해야 하는 비지속 연결에 비해 빠르게 여러 HTTP 요청과 응답을 처리할 수 있다.**
<br />
---
<br />

## HTTP 메시지 구조

HTTP 메시지는 시작 라인, 필드 라인, 메시지 본문으로 이루어져 있다. 필드 라인은 없거나 여러개 있을 수 있고, 메시지 본문은 없을 수 있다. 

또한 필드라인과 메시지 본문 사이에는 빈 줄바꿈이 있을 수 있다.
<br />


- 시작라인
    - HTTP 메시지는 HTTP 요청 메시지일 수도 있고, HTTP 응답 메시지일 수도 있다. 이때, HTTP메시지가 HTTP 요청 메시지일 경우 시작 라인은 ‘요청 라인’이 되고, HTTP 메시지가 HTTP 응답 메시지일 경우 시작 라인은 ‘상태 라인’이 된다.
- 메서드
    - 클라이언트가 서버의 자원(요청 대상)에 대해 수행할 작업의 종류를 나타낸다. 대표적으로는 GET, POST, PUT, DELETE 등이 있다. 요청 대상이 같아도 메서드가 다르면 각기 다른 요청으로 처리된다.
- 요청 대상
    - 요청 대상은 HTTP 요청을 보낼 서버의 자원을 의미한다. 보통 이곳에는 (쿼리가 포함된) URI의 경로가 명시된다. 만약 하위 경로가 없더라도 요청 대상은 슬래시(/)로 표기해야한다.
- HTTP 버전
    - 이름 그대로 사용된 HTTP 버전을 의미한다. HTTP 버전 1.1은 HTTP/1.1로 표기된다.
- 상태코드
    - 요청에 대한 결과를 나타내는 세자리 정수이다.
- 필드라인
    - 필드라인에는 0개 이상의 HTTP 헤더가 명시된다. 그래서 이를 헤더 라인이라고도 부른다. HTTP 헤더란 HTTP 통신에 필요한 부가 정보를 의미한다.
- 메시지 본문
    - HTTP 요청 혹은 응답 메시지에서 본문이 필요할 경우 메시지 본문에 명시된다. 메시지 본문은 존재하지 않을수도 있고, 다양한 콘텐츠 타입이 사용될 수도 있다.
<br />
---
<br />

## HTTP 메서드
<br />

- **GET - 가져다주세요**
    - GET 메서드는 특정 자원을 조회할 때 사용되는 메서드 이다.
    - 조회하고자 하는 자원은 HTML 파일이 될 수도 있고, JSON이 될 수도 있다.
    - GET 메서드에서는 요청 메시지에 본문(request body) 포함 시키는 것은 바람직하지 않다.  GET 요청 메시지에는 메시지 본문 보다는 쿼리 문자열을 사용하는 경우가 많다.
<br />
    
- **HEAD - 헤더만 가져다 주세요**
    - HEAD 메서드는 사실상 GET 메서드와 동일한 역할을 한다. 유일한 차이점은 응답 메시지에 메시지 본문이 포함되지 않는다는 것이다.
    - HEAD 메서드를 사용하면 서버는 요청에 대한 응답으로 응답 메시지의 헤더만을 반환한다.
<br />

- **POST - 처리해주세요**
    - POST 메서드는 서버로 하여금 특정 작업을 처리하도록 요청하는 메서드이다.
    - POST  메서드는 범용성이 매우 넓은 메서드이며, 보통 ‘클라이언트가 서버에 새로운 자원을 생성하고자 할 때’  사용된다.
    - 성공적으로 POST 요청이 처리되어 새로운 자원이 생성되면 서버는 응답 메시지의 Location 헤더를 통해 새로 생성된 자원의 위치를 클라이언트에게 알려줄 수 있다.

- **PUT - 덮어써 주세요**
    - PUT 메서드는 쉽게 말해서 ‘덮어쓰기’를 요청하는 메서드이다.
    - 요청 자원이 없다면 메시지 본문으로 자원을 새롭게 생성하거나, 이미 자원이 존재한다면 메시지 본문으로 자원을 완전히 대체하는 메서드이다.
<br />

- **PATCH - 일부 수정해 주세요**
    - PUT 메서드가 덮어쓰기, 완전한 대체에 가깝다면 PATCH 메서드는 부분적 수정에 가깝다.
    - PATCH 메서드로 요청을 보낼 경우 메시지 본문에 맞게 자원이 일부 수정된다.
<br />

- **DELETE - 삭제해주세요**
    - DELETE 메서드는 특정 자원을 삭제하고 싶을 때 사용하는 메서드이다.
<br />
---
<br />

## HTTP  상태 코드

상태 코드는 요청에 대한 결과를 나타내는 세 자리 정수이다. 
<br />

- **200번대: 성공 상태 코드**
    - **200번대 상태 코드는 ‘요청이 성공했음’을 의미한다.**
    - 주로 사용되는 상태 코드는
        - **200(OK) ⇒ 요청이 성공 했음**
        - **201(Created) ⇒ 요청이 성공했으며, 새로운 자원이 생성되었음 ( ex. POST 요청을 통해 새로운 자원이 생성한 경우)**
        - **202(Accepted) ⇒ 요청은 잘 받았으나, 아직 요청한 작업을 끝내지 않았음 (ex. 작업시간이 긴 대용량 파일 업로드 작업이나 배치 작업과 같이 요청 결과를 곧바로 응답하기 어려운 상황일 경우)**
        - **204(No Content) ⇒ 요청이 성공했지만, 메시지 본문으로 표시할 데이터가 없음(ex. 요청이 성공적으로 작업을 완료했더라도 마땅히 메시지 본문으로 표기할 것이 없을 경우)**
<br />

- **300번대: 리다이렉션 코드**
    - 300번대 상태 코드는 리다이렉션과 관련된 상태 코드이다.
    - **리다이렉션은 클라이언트가 요청한 자원이 다른 곳에 있을 때, 클라이언트의 요청을 다른 곳으로 이동시키는 것을 의미한다.**
    - 클라이언트가 요청한 자원이 다른  URL에 있을 경우, 서버는 응답 메시지의 Location  헤더를 통해 요청한 자원이 위치한 URL을 안내해 줄 수 있다. 이를 수신한 클라이언트는  Location 헤더에 명시된 URL로 즉시 재요청을 보내어 새로운 URL에 대한 응답을 받게 된다.
    - 리다이렉션은 크게 영구적인 리다이렉션과 일시적이 리다이렉션으로 구분된다.
        - **영구적인 리다이렉션은 자원이 완전히 새로운 곳으로 이동하여 경로가 영구적으로 재지정되는 것을 의미한다.** 이 경우는 기존의 URL에 요청 메시지를 보내면 항상 새로운  URL로 리다이렉트 된다. (EX. 서버가 도메인을 이전하는 등 웹 사이트의 큰 개편이 있을 때 사용)
            - 영구적인 리다이렉션과 관련된 상태코드는
                - **301(Moved Permanently) ⇒ 영구적 리다이렉션: 재요청 메서드 변경될 수 있음**
                - **308 (Permanent Redirect) ⇒ 영구적 리다이렉션: 재요청 메서드 변경되지 않음**
                
        - **일시적인 리다이렉션은 자원의 위치가 임시로 변경되었거나 임시로 사용할 URL이 필요한 경우에 주로 사용된다.** 어떤 URL에 대해 일시적인 리다이렉션 관련 상태 코드를 응답받았다면 여전히 요청을 보낸 URL은 기억해야 한다.
            - 일시적인 리다이렉션과 관련된 상태코드는
                - **302 (Found) ⇒ 일시적인 리다이렉션: 재요청 메서드는 변경될 수 있음**
                - **303 (See Other) ⇒ 일시적인 리다이렉션: 재요청 메서드는 GET으로 변경**
                - **307 (Temporary Redirect)⇒ 일시적인 리다이렉션: 재요청 메서드는 변경되지 않음**
    - 304(Not Modified)는 ‘자원이 변경되지 않았음’을 의미하는 상태 코드이며, 캐시와 관련된 상태 코드이다.
<br />

- **400번대: 클라이언트 에러 상태 코드**
    - 400번대 상태코드는 ‘클라이언트에 의한 에러가 있음’을 알려주는 상태코드이다.
    - 서버가 처리할 수 없는 형태로 요청을 보냈거나, 존재하지 않는 자원에 대해 요청을 보내는 경우가 속한다.
    - 주로 사용되는 상태 코드는
        - **400 (Bad Request) ⇒ 클라이언트의 요청이 잘못되었음**
        - **401 (Unathorized) ⇒ 요청한 자원에 대한 유효한 인증이 없음**
        - **403 (Forbidden) ⇒ 요청이 서버에 의해 거부됨(ex. 접근 권한이 없는 경우)**
        - **404  (Not Found) ⇒ 요청받은 자원을 찾응 수 없음**
        - **405 (Method Not Allowed) ⇒ 요청한 메서드를 지원하지 않음**
<br />

- **500번대: 서버 에러 상태 코드**
    - 500번대 상태 코드는 클라이언트가 올바르게 요청을 보냈을지라도 발생할 수 있는 서버 에러에 대한 상태 코드이다.
    - 주로 사용되는 상태 코드는
        - **500 (Internet Server Error) ⇒ 요청을 처리할 수 없음 (ex. 서버 내 오류, 다소 포괄적임)**
        - **502 (Bad Gateway) ⇒ 중간 서버의 통신 오류 (ex. 클라이언트와 서버 사이에 위치한 중 간 서버의 통신 오류)**
        - **503 ( Service Unavailble) ⇒ 현재는 요청을 처리할 수 없으나 추후 가능할 수도 있음 (ex. 서버가 과부하 상태에 있거나 일시적인 점검 상태)**
<br />
<br />
